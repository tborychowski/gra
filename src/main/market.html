<section class="store-front">
	<div class="table-wrap">
		<h2>Cargo</h2>
		<table>
			<thead><tr>
				<td class="item-name">Name</td>
				<td>Amount</td>
				<td>Paid</td>
				<td>Can get</td>
				<td></td>
			</tr></thead>
			<tbody>
				{#each Object.entries($cargo) as [itemId, item]}
				<tr>
					<td class="item-name">{$models.wares[itemId].name}</td>
					<td>{item.amount}</td>
					<td>{item.price}</td>
					<td>{$prices[itemId] && $prices[itemId].price}</td>
					<td><button on:click="sell(itemId, item)">Sell</button></td>
				</tr>
				{/each}
			</tbody>
		</table>
	</div>
	<div class="table-wrap">
		<h2>Market</h2>
		<table>
			<thead><tr>
				<td class="item-name">Name</td>
				<td>Price</td>
				<td></td>
			</tr></thead>
			<tbody>
				{#each Object.entries($prices) as [itemId, item]}
					{#if item.show}
					<tr>
						<td class="item-name">{item.name}</td>
						<td>{item.price}</td>
						<td><button on:click="buy(itemId, item)">Buy</button></td>
					</tr>
					{/if}
				{/each}
			</tbody>
		</table>
	</div>
</section>


<script>
import Data from '../data';

export default {
	store: () => Data.Store,
	methods: {
		sell (itemId, item) {
			let amount = window.prompt('How much?', item.amount);
			if (!amount) return;
			amount = parseInt(amount, 10);
			this.store.sell(itemId, amount);
		},

		buy (itemId, item) {
			const {cash} = this.store.get();
			const max = Math.floor(cash / item.price);
			let amount = window.prompt('How much?', max);
			if (!amount) return;
			amount = parseInt(amount, 10);
			if (amount > max) return alert('You don\'t have enough cash!');
			this.store.buy(itemId, amount);
		}
	}
};
</script>
