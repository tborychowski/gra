<section>
	<h1>Money</h1>
	<div class="cash-box">Cash: {formatNumber($cash)}</div>
	<div class="bank-box">Bank: {formatNumber($bank)}</div>

	{#if $bank === 0}
		<button on:click="onclick('deposit')">Deposit</button>
		<button on:click="onclick('loan')">Loan</button>
	{:elseif $bank < 0}
		<button on:click="onclick('repay')">Repay</button>
		<button on:click="onclick('loan')">Loan</button>
	{:else}
		<button on:click="onclick('deposit')">Deposit</button>
		<button on:click="onclick('withdraw')">Withdraw</button>
	{/if}
</section>

<script>
import Data from '../data';
import {formatNumber} from '../util';

export default {
	store: () => Data.Store,
	helpers: {
		formatNumber
	},
	methods: {
		onclick (action) {
			const {cash, bank} = this.store.get();
			let amount = 1000;

			if (action === 'repay') amount = Math.min(Math.abs(bank), cash);
			else if (action === 'deposit') amount = cash;
			else if (action === 'withdraw') amount = bank;

			amount = window.prompt('How much?', amount);
			if (!amount) return;
			amount = parseInt(amount, 10);


			if (action === 'withdraw' || action === 'loan') this.store.withdraw(amount);
			else {	// deposit, repay
				if (amount > cash) return alert('You don\'t have enough cash!');
				this.store.deposit(amount);
			}

		},
	}
};
</script>
